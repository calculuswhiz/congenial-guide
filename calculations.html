<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>The Facts About BitcoinIRA.com</title>
    <script src="./bracketUtils.js"></script>
    <script type="text/javascript">
        function populateStates(){
            let stateEl = document.getElementById("state");
            for(let state in stateBrackets){
                let opt = document.createElement("option");
                opt.setAttribute('value', state);
                opt.innerHTML = state;
                stateEl.appendChild(opt);
            }
        }
        
        function populateRow(rowEl, data){
            for(let datum of data){
                let td = document.createElement("td");
                td.innerHTML = datum;
                rowEl.appendChild(td);
            }
        }
        
        function getEarningsPct(price, principle){
            return ((price/principle-1)*100).toFixed(1);
        }
        
        function fillInfo(){
            let maritalStatus = document.getElementById("single").checked?"single":"joint";
            let preWithdraw = parseFloat(document.getElementById("income").value);
            let principle = parseFloat(document.getElementById("principle").value);
            let state = document.getElementById("state").value;
            
            let actualPrinciple;
            
            if ( isNaN(preWithdraw) || isNaN(principle) ) {
                alert("Please input values.")
                return;
            }
            
            [...document.getElementsByClassName("bciraTableRow")].forEach(row=>row.remove());
            
            if(0<principle && principle<15000){
                document.getElementById("bciraCharge").innerHTML = "BitcoinIRA.com requires a minimum investment of 15000";
                document.getElementById("bciraActualPrinciple").innerHTML = "";
                actualPrinciple = -1;
            } else if (15000<=principle && principle < 100000){
                document.getElementById("bciraCharge").innerHTML = (principle * .15).toFixed(2);
                document.getElementById("bciraActualPrinciple").innerHTML = (principle * .85).toFixed(2);
                actualPrinciple = (principle * .85).toFixed(2);
            } else if (100000 <= principle && principle < 200000) {
                document.getElementById("bciraCharge").innerHTML = (principle * .13).toFixed(2);
                document.getElementById("bciraActualPrinciple").innerHTML = (principle * .87).toFixed(2);
                actualPrinciple = (principle * .87).toFixed(2);
            } else if (200000 <= principle) {
                document.getElementById("bciraCharge").innerHTML = (principle * .11).toFixed(2);
                document.getElementById("bciraActualPrinciple").innerHTML = (principle * .89).toFixed(2);
                actualPrinciple = (principle * .89).toFixed(2);
            } else {
                document.getElementById("bciraCharge").innerHTML = "Ha, I wish.";
                document.getElementById("bciraActualPrinciple").innerHTML = "";
                actualPrinciple = -1;
            }
            
            if(actualPrinciple > 0){
                for(let returns=0; returns<50; returns+=1){
                    let tr = document.createElement("tr");
                    tr.setAttribute("class", "bciraTableRow");
                    
                    let totalWorth = actualPrinciple * (returns/10+1);
                    let earnings = actualPrinciple * returns/10;
                    let lostAmountPrior = (totalWorth*(getFederalTaxRate(preWithdraw, maritalStatus) + getStateTaxRate(state, maritalStatus, preWithdraw)));
                    let lostAmountAfter = earnings*(getFederalTaxRate(preWithdraw, maritalStatus) + getStateTaxRate(state, maritalStatus, preWithdraw));
                    let rothPrior = (totalWorth - lostAmountPrior)*.9;
                    let rothAfter = (totalWorth - lostAmountAfter) * .9;
                    let tradPrior = (totalWorth - lostAmountPrior)*.9;
                    let tradAfter = totalWorth - lostAmountPrior;
                    
                    let data = [`${Math.floor(returns/10*100)}`,
                    `${totalWorth.toFixed(2)} (${getEarningsPct(totalWorth,principle)}%)`,
                    `${rothPrior.toFixed(2)} (${getEarningsPct(rothPrior,principle)}%) / ${rothAfter.toFixed(2)} (${getEarningsPct(rothAfter,principle)}%)`,
                    `${tradPrior.toFixed(2)} (${getEarningsPct(tradPrior,principle)}%) / ${tradAfter.toFixed(2)} (${getEarningsPct(tradAfter,principle)}%)`];
                    populateRow(tr, data);
                    document.getElementById("infoTable").appendChild(tr);
                }
            } else {
                let tr = document.createElement("tr");
                tr.setAttribute("class", "bciraTableRow");
                populateRow(tr, ["Error"]);
                document.getElementById("infoTable").appendChild(tr);
            }
        }
        
        function init(){
            populateStates();
        }
    </script>
</head>
<body onload="init()">
<!-- Over 59Â½? <input type="checkbox" id="age"><br /> -->
<!-- Holding for over a year? <input type="checkbox" id="shortTerm"><br /> -->
File as single? <input type="checkbox" id="single"> <br />
Pre-withdrawal income:<input type="text" id="income" value="0"><br />
Principle:<input type="text" id="principle" value="0"><br />
State of Residence:<select id="state"></select> <br />
<button onclick="fillInfo()">Calculate</button> <br />
Calculations <br/>
- Assumes all earnings are in excess of your current bracket <br />
- Ignores $100/yr holding charge.
<div id="infodump">
    <center><font color="red"><b>BitcoinIRA.com:</b></font></center>
    <b>Amount kept by Bitcoin IRA:</b> <span id="bciraCharge"></span> <br />
    <b>Amount you actually invest:</b> <span id="bciraActualPrinciple"></span> <br />
    <table id="infoTable" style='width:100%' border="1">
        <tr>
            <th>% Price Up:</th>
            <th>Net Price @ End:</th>
            <th>Pre-retire Roth - Before/After 5 years:</th>
            <th>Traditional - Before/After retire:</th>
        </tr>
    </table>
</div>
</body>
</html>